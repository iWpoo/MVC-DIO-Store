<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link rel="stylesheet" type="text/css" href="/project/webroot/css/style.css">
		<link rel="stylesheet" type="text/css" href="/project/webroot/css/cart.css">
		<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat">
		<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto Mono">
		<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Pacifico">
		<script src="/project/webroot/js/jquery-3.6.4.min.js"></script>
		<title>DIO</title>
	</head>
	<body>
		<header>
			<div class="container">
				<nav class="navbar">
					<div>
						<a href="#">
							<span class="active">–ì–ª–∞–≤–Ω–∞—è</span>
						</a>
						<a href="#">–û –ú–∞–≥–∞–∑–∏–Ω–µ</a>
						<a href="#">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a>
					</div>
					<div>
						<a href="#">–í—Ö–æ–¥</a>
						<a href="#">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
					</div>
				</nav>
				<hr>

				<div class="header">
					<a href="#" class="logo">DIO</a>
					<div class="search-container">
						<input type="text" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –∫–∞—Ç–∞–ª–æ–≥—É –º–∞–≥–∞–∑–∏–Ω–∞">
						<button type="submit">–ù–∞–π—Ç–∏</button>
					</div>
					<div class="basket">
						<img src="basket.png">
						<label>–ö–æ—Ä–∑–∏–Ω–∞</label>
					</div>
				</div>
			</div>
		</header>

		<main>
			<div class="container main">

				<div class="right block-basket">

					<div class="block-title">
						<div class="block-elem">
							<input type="checkbox" class="select-all-checkbox" id="choose-all">
							<label for="choose-all" style="margin-left: 5px;">–í—ã–±—Ä–∞—Ç—å –≤—Å—ë</label>
						</div>
						<h1 style="font-family: Montserrat;">–ö–æ—Ä–∑–∏–Ω–∞</h1>
						<div class="block-elem">
							<label style="margin-right: 5px;" for="delete_selected">–£–¥–∞–ª–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω–æ–µ</label>
							<img src="/project/webroot/img/musorka.png" id="delete_selected" width="28px">
						</div>
					</div>
					<hr style="height: 1px; border: 0; background-color: #CCCFD3; margin: 0;">
					{% for product in products %}
						<div class="card-item product-{{ product.id }}">
							<div class="left-item">
								<div style="display: flex; align-items: center;">
									<input type="checkbox" class="checkbox" id="choose-all" name="delete_cart[]" value="{{ product.id }}">
									<a href="/product/{{ product.id }}"><img src="/project/webroot/uploads/{{ product.image }}" class="card-item-image"></a>
								</div>
								<a href="/product/{{ product.id }}" style="margin-left: 16px; margin-right: 16px;">{{ product.title }}
									{{ product.memory }}
									{{ product.color }}</a>
							</div>
							<div class="right-item">
								<div id="count">
									<h2 class="changeAmount-{{ product.id }}" onclick="decrement({{ product.id }})">-</h2>
									<h2 class="quantity-{{ product.id }}">{{ product.count ? product.count : 1 }}</h2>
									<h2 class="changeAmount-{{ product.id }}" onclick="increment({{ product.id }})">+</h2>
								</div>
								<input type="hidden" id="csrf_token" name="csrf_token" value="{{ csrf_token }}">
								<label class="deleteProduct-{{ product.id }}" style="color: red; margin-left: 16px;">–£–¥–∞–ª–∏—Ç—å</label>
								<h1 class="price">
									<span class="p p-{{ product.id }}">{{ product.price }}</span>‚ÇΩ
								</h1>
								<span class="pricesss cost-{{ product.id }}" style="display: none;">0</span>
							</div>
						</div>

						<script>

							// –í—ã–±—Ä–∞—Ç—å –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è
var selectAllCheckbox = document.querySelector('.select-all-checkbox');
var checkboxes = document.querySelectorAll('input[type=checkbox]:not(.select-all-checkbox)');

selectAllCheckbox.addEventListener('change', function () {
for (var i = 0; i < checkboxes.length; i++) {
checkboxes[i].checked = this.checked;
}
});

for (var i = 0; i < checkboxes.length; i++) {
checkboxes[i].addEventListener('change', function () {
if (!this.checked) {
selectAllCheckbox.checked = false;
} else {
var allChecked = true;

for (var j = 0; j < checkboxes.length; j++) {
if (! checkboxes[j].checked) {
allChecked = false;
break;
}
}

selectAllCheckbox.checked = allChecked;
}
});
}

function reloadPage(csrf) {
$.ajax({
url: '/cart',
method: 'POST',
dataType: 'html',
data: {},
success: function (data) {
$('#csrf_token').val(csrf);
}
});
}

// –£–¥–∞–ª–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
$('#delete_selected').on("click", function () {
let selected = $('.checkbox:checked').map(function () {
return $(this).val();
}).get();

$.ajax({
url: '/cart/delete-selected',
type: 'POST',
cache: false,
data: {
'delete_cart': selected
},
dataType: 'html',
success: function (res) {
if (selected.length != 0) {
	for (let i = 0; i < selected.length; i++) {
        $('.product-' + selected[i]).remove();
	}
}
reloadPage(res);
emptyCart();
}
});
});


// –£–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –∏–∑ –∫–æ—Ä–∑–∏–Ω–∫–∏
$(".deleteProduct-{{ product.id }}").on("click", function () {
let csrf = $('#csrf_token').val();
$.ajax({
url: '/product/cart/{{ product.id }}',
type: 'POST',
cache: false,
data: {
'csrf_token': csrf
},
dataType: 'html',
success: function (data) {
$('.product-{{ product.id }}').remove();
reloadPage(data);
emptyCart();
}
});
});
						</script>
						<script>
												function updatePrice(id) {
let quantity = parseInt(document.querySelector('.quantity-' + id).innerHTML);
let price = parseInt(document.querySelector('.p-' + id).innerText);
let update = price * quantity;
document.querySelector('.cost-' + id).innerText = update;
updateTotalPrice();
}

$(".changeAmount-{{ product.id }}").on("click", function() {
			let quantity = $('.quantity-{{ product.id }}').text();
            $.ajax({
                url: '/cart',
                type: 'POST',
                cache: false,
                data: {'counter': quantity, 'product_id': '{{ product.id }}', 'price': '{{ product.price }}'},
                dataType: 'html',
                success: function (data) {
                    updatePrice('{{ product.id }}');
                }
            });
        });

		window.onload = updatePrice('{{ product.id }}');

						</script>

					{% endfor %}
					<hr style="height: 1px; border: 0; background-color: #CCCFD3; margin: 0;">
					<a href="/order" style="display: block; width: 100%; text-align: center;"><button type="submit">–ö—É–ø–∏—Ç—å –∑–∞ <span class="total-price">0</span>‚ÇΩ</button></a>
				</div>
			</div>

			<div class="empty_cart" style="display: none;">
				<h3>–ö–û–†–ó–ò–ù–ê –ü–£–°–¢–ê</h3>
				<img src="/project/webroot/img/emptycart.png">
				<span>–í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞. –ù–∞—á–Ω–∏—Ç–µ —Å –ø–æ–∏—Å–∫–∞ —á–µ–≥–æ-—Ç–æ –ø–æ–¥—Ö–æ–¥—è—â–µ–≥–æ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∏–ª–∏ –≤–æ—Å–ø–æ–ª—å–∑—É–π—Ç–µ—Å—å –ø–æ–∏—Å–∫–æ–º</span>
			</div>
		</main>

		<script>
			function emptyCart() {
let cart = document.querySelector('.card-item');
if (cart === null) {
document.querySelector('.main').style.display = 'none';
document.querySelector('.empty_cart').style.display = 'flex';
} else {
document.querySelector('.empty_cart').style.display = 'none';
document.querySelector('.main').style.display = 'flex';
}
}

window.onload = emptyCart();
		</script>

		<footer>
			<div class="footer">
				<div class="subfooters">
					<div class="title">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</div><br>
					<ul class="footer-categories-list">
						<li>
							<a href="#">–ê–∫—Å–µ—Å—Å—É–∞—Ä—ã</a>
						</li>
						<li>
							<a href="#">–°–º–∞—Ä—Ç—Ñ–æ–Ω—ã</a>
						</li>
						<li>
							<a href="#">–ü–ª–∞–Ω—à–µ—Ç—ã</a>
						</li>
						<li>
							<a href="#">–ù–∞—É—à–Ω–∏–∫–∏ –∏ –∫–æ–ª–æ–Ω–∫–∏</a>
						</li>
						<li>
							<a href="#">–ß–∞—Å—ã</a>
						</li>
						<li>
							<a href="#">–ì–∞–¥–∂–µ—Ç—ã</a>
						</li>
						<li>
							<a href="#">–≠–ª–µ–∫—Ç—Ä–æ—Å–∞–º–æ–∫–∞—Ç—ã</a>
						</li>
						<li>
							<a href="#">–ù–æ—É—Ç–±—É–∫–∏</a>
						</li>
					</ul>
				</div>

				<div class="subfooters">
					<div class="title">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</div><br>
					<ul class="footer-categories-list">
						<li>
							<a href="#">–ì–ª–∞–≤–Ω–∞—è</a>
						</li>
						<li>
							<a href="#">–û –º–∞–≥–∞–∑–∏–Ω–µ</a>
						</li>
						<li>
							<a href="#">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a>
						</li>
					</ul>
				</div>

				<div class="subfooters">
					<div class="title">–ö–æ–Ω—Ç–∞–∫—Ç—ã</div><br>
					<ul class="footer-categories-list">
						<li>EMAIL: dio@gmail.com</li>
						<li>+7 (7777) 777-77-77</li>
					</ul>
				</div>
			</div>
			<hr>
			<div class="icons">
				<a href="#"><img class="icon" src="instagram.png"></a>
				<a href="#"><img class="icon" src="telegram.png"></a>
				<a href="#"><img class="icon" src="twitter.png"></a>
				<a href="#"><img class="icon" src="vk.png"></a>
			</div>
		</footer>

		<div class="MobileShowNavigation">
			<div class="button-buy-mobile">
				<a href="/order" style="display: block; width: 100%; text-align: center;"><button type="submit">–ö—É–ø–∏—Ç—å –∑–∞ <span class="total-price-mobile">0</span>‚ÇΩ</button></a>
			</div>
			<div class="menu">
				<img src="/project/webroot/img/home.png">
				<img src="/project/webroot/img/category.png">
				<img src="/project/webroot/img/basketicon.png">
				<a href=""><img src="/project/webroot/img/profile.png"></a>
			</div>
		</div>

		<script>

			// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è –¥–ª—è –∫–Ω–æ–ø–∫–∏ —É–≤–µ–ª–∏—á–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç–æ–≤–∞—Ä–∞
function increment(id) {
let quantity = parseInt(document.querySelector('.quantity-' + id).innerHTML);
quantity++;
document.querySelector('.quantity-' + id).innerHTML = quantity;
};

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è –¥–ª—è –∫–Ω–æ–ø–∫–∏ —É–º–µ–Ω—å—à–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç–æ–≤–∞—Ä–∞
function decrement(id) {
let quantity = parseInt(document.querySelector('.quantity-' + id).innerHTML);
if (quantity > 1) {
quantity--;
document.querySelector('.quantity-' + id).innerHTML = quantity;
}
};

function updateTotalPrice() {
let prices = document.querySelectorAll('.pricesss');
let arr = [];
for (let i = 0; i < prices.length; i++) {
arr.push(prices[i].innerHTML);
}
const sum = arr.reduce((acc, curr) => {
const num = parseInt(curr);
if (!isNaN(num)) {
acc += num;
}
return acc;
}, 0);
document.querySelector('.total-price').innerText = sum;
document.querySelector('.total-price-mobile').innerText = sum;
}

window.onload = updateTotalPrice();



		</script>
	</body>
</html>
