<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="/project/webroot/css/style.css">
    <link rel="stylesheet" type="text/css" href="/project/webroot/css/order.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto Mono">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Pacifico">
    <script src="/project/webroot/js/jquery-3.6.4.min.js"></script>
    <title>DIO</title>
</head>
<body>
    <header>
      <div class="container">
        <nav class="navbar">
            <div>
                <a href="#"><span class="active">–ì–ª–∞–≤–Ω–∞—è</span></a>
                <a href="#">–û –ú–∞–≥–∞–∑–∏–Ω–µ</a>
                <a href="#">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a>
            </div>
            <div>
                <a href="#">–í—Ö–æ–¥</a>
                <a href="#">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
            </div>
        </nav>
        <hr>
         
        <div class="header">
            <a href="#" class="logo">DIO</a>
            <div class="search-container">
                <input type="text" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –∫–∞—Ç–∞–ª–æ–≥—É –º–∞–≥–∞–∑–∏–Ω–∞">
                <button type="submit">–ù–∞–π—Ç–∏</button>
            </div>
            <div class="basket">
                <img src="/project/webroot/img/basket.png">
                <label>–ö–æ—Ä–∑–∏–Ω–∞</label>
            </div>
        </div>
      </div>
    </header>

    <main class="order">
        <div class="order_container">
        <h3 class="order_title">–û–§–û–†–ú–õ–ï–ù–ò–ï –ó–ê–ö–ê–ó–ê</h3>
        <div class="order_block">
            <div class="address_info">
                <h4>–ê–î–†–ï–° –î–û–°–¢–ê–í–ö–ò</h4>
                <div style="color: #DC3545; font-family: Roboto Mono;">{{ errors.address_required }}</div>
                <div class="info">{{ user.address ? user.address : "<a href='/edit/profile'><li style='color: #318CE7;'>–î–æ–±–∞–≤–∏—Ç—å –∞–¥—Ä–µ—Å</li></a>" }}</div>
                <hr>
                <h4>–ö–û–ù–¢–ê–ö–¢–ù–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø</h4>
                <div class="info">{{ user.first_name or user.last_name ? user.first_name : "<a href='/edit/profile'><li style='color: #318CE7;'>–î–æ–±–∞–≤–∏—Ç—å –∏–º—è</li></a>" }} {{ user.last_name }}</div><br>
                <div style="color: #DC3545; font-family: Roboto Mono;">{{ errors.phone_required }}</div>
                <div class="info">{{ user.phone ? user.phone : "<a href='/edit/profile'><li style='color: #318CE7;'>–î–æ–±–∞–≤–∏—Ç—å —Ç–µ–ª–µ—Ñ–æ–Ω</li></a>" }}</div><br>
                <div class="info">{{ user.email }}</div>
            </div>
            <div class="payments-methods">
                <h4>–°–ü–û–°–û–ë–´ –û–ü–õ–ê–¢–´</h4>
                <p id="payment_num" style="display: none;"></p>
                <hr>
                <div class="payment-methods">
                <div class="payment-methods-method" onclick="updateText(this, 1)">
                    <img alt="" src="/project/webroot/img/money.svg">
                    <div>
                        <span>–ß–µ—Ä–µ–∑ –∫—É—Ä—å–µ—Ä–∞</span>
                        <p>(–æ–ø–ª–∞—Ç—ã –Ω–∞–ª–∏—á–Ω—ã–º–∏)</p>
                    </div>
                </div>   
                <div class="payment-methods-method" onclick="updateText(this, 2)">
                    <img alt="" src="/project/webroot/img/samovyzov.svg">
                    <div>
                        <span>–°–∞–º–æ–≤—ã–∑–æ–≤</span>
                    </div>
                </div> 
                <div class="payment-methods-method" onclick="updateText(this, 3)">
                    <img alt="" src="/project/webroot/img/payments.svg">
                    <div>
                        <span>–ü–µ—Ä–µ–≤–æ–¥—ã</span>
                        <p>(–°–±–µ—Ä–ë–∞–Ω–∫, QiWi –∏ WebMoney)</p>
                    </div>
                </div> 
                <div class="payment-methods-method" onclick="updateText(this, 4)">
                    <img alt="" src="/project/webroot/img/crypto.svg">
                    <div>
                        <span>–ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–æ–π</span>
                    </div>
                </div> 
                </div>
                <span class="methods_description"></span>         
            </div>
        </div>
        <div class="order_block">
            <form class="order-data">
                <h4>–¢–û–í–ê–†–´</h4>
                <hr>
                {% for product in products %}
                <div class="order-data_product" data-id="{{ product.id }}">
                    <div class="order-data_product-block">
                        <span class="order-data_product-quan quantity-{{ product.id }}">{{ product.count }}</span>
                        <img alt="" src="/project/webroot/uploads/{{ product.image }}" class="order-data_product-image">
                        <div class="order-data_product-data">
                            <span class="order-data-title">{{ product.title }}</span>
                        </div>  
                    </div>
                    <div class="order-data_product-prices">
                        <span class="order-data_product-price"><span class="product_price p-{{ product.id }}">{{ product.price }}</span>‚ÇΩ</span>
                    </div>
                </div>
                <div class="order-data_data">
                    <span>–°—Ç–æ–∏–º–æ—Å—Ç—å</span>
                    <span class="order-data_data-price"><span class="pricesss cost-{{ product.id }}">0</span>‚ÇΩ</span>
                </div>
                <hr>

                <script>
                    function updatePrice() {
let quantity = parseInt(document.querySelector('.quantity-{{ product.id }}').innerHTML);
let price = parseInt(document.querySelector('.p-{{ product.id }}').innerText);
let update = price * quantity;
document.querySelector('.cost-{{ product.id }}').innerText = update;
}
window.onload = updatePrice();
                </script>
            {% endfor %}
                <div class="order-data_total">
                    <span class="order-data_total-total">–ò—Ç–æ–≥–æ</span>
                    <span class="order-data_total-price"><span class="total">0</span>‚ÇΩ</span>
                </div>
                <button class="order-data_button" onclick="makeOrder()" type="button">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
            </form>
        </div>
        </div>
    </main>

    <script>
        function updateText(element, text) {
            // –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –∏ —É–±–∏—Ä–∞–µ–º —É –Ω–∏—Ö –∑–µ–ª–µ–Ω—É—é —Ä–∞–º–∫—É
            const items = document.querySelectorAll(".payment-methods-method");
            items.forEach(item => item.style = "border: 1px solid #a9a7a6;");

            // –í—ã–±—Ä–∞–Ω–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç –∑–µ–ª–µ–Ω—É—é —Ä–∞–º–∫—É
            element.style = "border: 2px solid #00D270";

            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –≤ —Ç–µ–≥–µ span
            texts(text);
        }

        function texts(text) {
            const output = document.querySelector('.methods_description');
            const payment_num = document.getElementById('payment_num');
            if (text == 1) {
                payment_num.innerText = 1;
                output.innerText = `–í—ã–±—Ä–∞–Ω–Ω—ã–π —Å–ø–æ—Å–æ–± –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç –æ–ø–ª–∞—Ç—É –Ω–∞ –º–µ—Å—Ç–µ, –≤–æ –≤—Ä–µ–º—è –ø–µ—Ä–µ–¥–∞—á–∏ —Ç–æ–≤–∞—Ä–∞ –∑–∞–∫–∞–∑—á–∏–∫—É.`;
            } else if (text == 2) {
                payment_num.innerText = 2;
                output.innerText = `–ó–∞–∫–∞–∑ —Ä–µ–∑–µ—Ä–≤–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –≤–∞—à–µ –§–ò–û –∏ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ —Ç–µ—á–µ–Ω–∏–∏ –Ω–µ–¥–µ–ª–∏. –ü–æ—Å–ª–µ –∏—Å—Ç–µ—á–µ–Ω–∏—è —Å—Ä–æ–∫–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è, —Ç–æ–≤–∞—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —è–≤–ª—è–µ—Ç—Å—è –∞–∫—Ç–∏–≤–Ω—ã–º –¥–ª—è –ø—Ä–æ–¥–∞–∂–∏ –∏ –±–æ–ª—å—à–µ –Ω–µ —á–∏—Å–ª–∏—Ç—Å—è –≤ –±–∞–∑–µ –∑–∞ –≤–∞—à–∏–º –∏–º–µ–Ω–µ–º`;
            } else if (text == 3) {
                payment_num.innerText = 3;
                output.innerText = `–í—ã–±—Ä–∞–≤ –¥–∞–Ω–Ω—ã–π —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã, –Ω–∞—à –æ–ø–µ—Ä–∞—Ç–æ—Ä —Å–≤—è–∑—ã–≤–∞–µ—Ç—Å—è —Å –≤–∞–º–∏, –æ–±—ä—è—Å–Ω—è–µ—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –ø–æ –ø–µ—Ä–µ–≤–æ–¥—É –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ —Å—á—ë—Ç–∞. –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø–µ—Ä–µ–≤–æ–¥–∞, –≤–∞—à —Ç–æ–≤–∞—Ä, –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –¥–æ—Å—Ç–∞–≤–∫–∏, —Å–ª–µ–¥—É–µ—Ç —É–∫–∞–∑–∞–Ω–Ω–æ–º—É –º–∞—Ä—à—Ä—É—Ç—É.`;
            } else if (text == 4) {
                payment_num.innerText = 4;
                output.innerText = `–í—ã–±—Ä–∞–≤ –¥–∞–Ω–Ω—ã–π —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã, –Ω–∞—à –æ–ø–µ—Ä–∞—Ç–æ—Ä —Å–≤—è–∑—ã–≤–∞–µ—Ç—Å—è —Å –≤–∞–º–∏, –æ–±—ä—è—Å–Ω—è–µ—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –ø–æ –ø–µ—Ä–µ–≤–æ–¥—É –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ —Å—á—ë—Ç–∞. –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø–µ—Ä–µ–≤–æ–¥–∞, –≤–∞—à —Ç–æ–≤–∞—Ä, –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –¥–æ—Å—Ç–∞–≤–∫–∏, —Å–ª–µ–¥—É–µ—Ç —É–∫–∞–∑–∞–Ω–Ω–æ–º—É –º–∞—Ä—à—Ä—É—Ç—É.`;
            }
        }

        function updateTotalPrice() {
let prices = document.querySelectorAll('.pricesss');
let arr = [];
for (let i = 0; i < prices.length; i++) {
arr.push(prices[i].innerHTML);
}
const sum = arr.reduce((acc, curr) => {
const num = parseInt(curr);
if (!isNaN(num)) {
acc += num;
}
return acc;
}, 0);
document.querySelector('.total').innerText = sum;
}

window.onload = updateTotalPrice();

</script>

    <footer>
        <div class="footer">
            <div class="subfooters">
                <div class="title">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</div><br>
                <ul class="footer-categories-list">
                    <li><a href="#">–ê–∫—Å–µ—Å—Å—É–∞—Ä—ã</a></li>
                    <li><a href="#">–°–º–∞—Ä—Ç—Ñ–æ–Ω—ã</a></li>
                    <li><a href="#">–ü–ª–∞–Ω—à–µ—Ç—ã</a></li>
                    <li><a href="#">–ù–∞—É—à–Ω–∏–∫–∏ –∏ –∫–æ–ª–æ–Ω–∫–∏</a></li>
                    <li><a href="#">–ß–∞—Å—ã</a></li>
                    <li><a href="#">–ì–∞–¥–∂–µ—Ç—ã</a></li>
                    <li><a href="#">–≠–ª–µ–∫—Ç—Ä–æ—Å–∞–º–æ–∫–∞—Ç—ã</a></li>
                    <li><a href="#">–ù–æ—É—Ç–±—É–∫–∏</a></li>
                </ul>
            </div>
    
            <div class="subfooters">
                <div class="title">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</div><br>
                <ul class="footer-categories-list">
                    <li><a href="#">–ì–ª–∞–≤–Ω–∞—è</a></li>
                    <li><a href="#">–û –º–∞–≥–∞–∑–∏–Ω–µ</a></li>
                    <li><a href="#">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a></li>
                </ul> 
            </div>
    
            <div class="subfooters">
                <div class="title">–ö–æ–Ω—Ç–∞–∫—Ç—ã</div><br>
                <ul class="footer-categories-list">
                    <li>EMAIL: dio@gmail.com</li>
                    <li>+7 (7777) 777-77-77</li>
                </ul>  
            </div>
            </div>
        <hr>
        <div class="icons">
            <a href="#"><img class="icon" src="instagram.png"></a>
            <a href="#"><img class="icon" src="telegram.png"></a>
            <a href="#"><img class="icon" src="twitter.png"></a>
            <a href="#"><img class="icon" src="vk.png"></a>
        </div>
    </footer>

    <div class="MobileShowNavigation">
        <div class="button-buy-mobile">
            <button onclick="makeOrder()" type="button">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
        </div>
        <div class="menu">
        <img src="/project/webroot/img/home.png">
        <img src="/project/webroot/img/category.png">
        <img src="/project/webroot/img/basketicon.png">
        <a href=""><img src="/project/webroot/img/profile.png"></a>
    </div>
    </div>

    <div class="modal" id="modal">
  <div class="modal-content">
    <p id="modal-text"></p>    
    <button class="modal-button-ok" onclick="modalBtnOk()" id="modal-button-ok">–û–ö</button>
  </div>
</div>

    <script>
        function makeOrder() {
            const product_ids = [];
            const products = document.querySelectorAll('.order-data_product');
            products.forEach((product) => {
                const dataId = product.getAttribute('data-id');
                product_ids.push(dataId);
            });

            const payment_method = document.getElementById('payment_num').innerText;

let modal = document.getElementById("modal");
let modalText = document.getElementById("modal-text");
let btnOk = document.getElementById("modal-button-ok");
        $.ajax({
          type: 'POST',
          url: '/order/make',
          data: {'product_ids': product_ids, 'payment_method': payment_method, 'csrf_token': '{{ csrf_token }}'},
          cache: false,
          dataType: 'html',
          success: function(data) {
            if (product_ids.length > 0) {
                if (data == '–ó–∞–∫–∞–∑ —É—Å–ø–µ—à–Ω–æ –æ—Ñ–æ—Ä–º–ª–µ–Ω!') {
                    modalText.style.color = '#28A745';
                    btnOk.onclick = function () {
                        window.location = '/profile/active/orders';
                    };
                } else {
                    modalText.style.color = '#DC3545';
                }
                modalText.innerText = data;
                modal.style.display = 'flex';
            } else {
                modalText.innerText = '–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–≤–∞—Ä –¥–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞.';
                modalText.style.color = '#DC3545';
                modal.style.display = 'flex';
            }
          }
        });
        }

        function modalBtnOk()
        {
            let modal = document.getElementById("modal");
            modal.style.display = 'none';
        }
    </script>

</body>

</html>